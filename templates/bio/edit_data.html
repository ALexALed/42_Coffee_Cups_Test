{% extends "base.html" %}
{% load edit_link %}

{% block title %}
    Edit data
{% endblock %}

{% block url_line %}
    {% if reverse %}
        <a href={% url edit_bio id %}>Normal order fields</a>
    {% else %}
        <a href={% url edit_bio_reverse id %}>Reverse fields</a>
    {% endif %}
        <a href="{% edit_link obj%}">Edit in admin</a>
{% endblock %}

{% block content %}
	<script type="text/javascript">
             jQuery(function() {
                   jQuery("#id_birth_date").datepicker({ dateFormat: 'yy-mm-dd' });
                });

             function submitStart(formData, jqForm, options) {
                    $("#errors").hide();
                    setEnabledDisabled(true);
                    jQuery("#sendwrapper").prepend('<span>Sending your bio, please wait... </span>')
                    return true;
                }

             function submitSuccess(responseText, statusText, xhr, form)  {
                    json_resp_obj = jQuery.parseJSON(responseText);
                    setEnabledDisabled("")
                    $("#errors").hide();
                    $("#sendwrapper").hide();
                    $("#done").hide();
                    if (json_resp_obj.status == "done_status") {
                        $("#done").show();
                        jQuery("#done").prepend("<p>Data saved done.</p>")
                    } else{
                        alert(json_resp_obj.errors);

                    }
                }

             function setEnabledDisabled(status){
                  jQuery("#sendbutton").attr('disabled',   status)
                  jQuery("#id_last_name").attr('disabled', status)
                  jQuery("#id_first_name").attr('disabled',status)
                  jQuery("#id_contacts").attr('disabled',  status)
                  jQuery("#id_biography").attr('disabled', status)
                  jQuery("#id_biography").attr('disabled', status)
             }

             $(function() {
             $("#editform").ajaxForm({
                    beforeSubmit:  submitStart,
                    success:       submitSuccess});
             return false;
             });


    </script>

    <form id="editform" action="" method="post">{% csrf_token %}
        {{ form.as_p }}
    <div id="sendwrapper"></div>
     <p><input id="sendbutton" type=submit value="Submit"></p>
    </form>

    <div id="errors">
                {% for error in form.errors %}
                    <p>{{ error }} not valid.</p>
                {% endfor %}
    </div>

    <div id="done"></div>

{% endblock %}

{% block url_main_page %}
     <p><a href={% url get-bio %}>To main page</a></p>
{% endblock %}